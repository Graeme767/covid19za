name: Scrape provincial data from sacoronavirus.co.za and/or nicd.ac.za
# The NICD data is release typically between 18:00 and 20:00.  Run this every 5 mins between those times   
# Adjusted to GMT+0 times
# This runner takes some time to setup, if we need to install R first.  

# test this locally by using the "act" tool:  https://github.com/nektos/act
# need to download the "full" version of the image, as R is not installed in the medium image.
# docker pull catthehacker/ubuntu:full-20.04
# act -j dailystats_scrape
# check the ~/.actrc file for mappings between ubuntu-20.04 and the full or medium images....

on:
  schedule:
    - cron: '*/5 16-18 * * *'

jobs:
  dailystats_scrape:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@master
      - name: Set up R
        uses: r-lib/actions/setup-r@v1
        with:
          r-version: '3.5.3'   # we don't need the latest R;  older versions are smaller and quicker to install.
      - name: Install dependencies
        run: |
          install.packages(c("git2r", "magrittr"), repos="https://cran.r-project.org/")
        shell: Rscript --vanilla {0}
      - name: Scrape data 
        run: Rscript --vanilla 'scripts/daily_prov_scraper.R'
      - name: Commit and push changes
        run: |
          if [[ "$(git status --porcelain)" != "" ]]; then
              git commit -m "Update Provincial Vaccinations Data" -a
              git push origin master
          fi
        env:
          REPO_KEY: ${{secrets.GITHUB_TOKEN}}
          username: github-actions

